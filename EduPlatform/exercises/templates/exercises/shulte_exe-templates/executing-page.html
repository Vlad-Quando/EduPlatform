{% extends "base.html" %}
{% load static %}

{% block style %}

<link rel="stylesheet" href="{% static "exercises/shulte_exe-styles/executing-page.css" %}">

{% endblock style %}

{% block content %}
<input id="data" type="hidden" data-size="{{ data.size }}">
<p class="current-letter" id="current-letter"></p>
<div class="table" id="table">
    {% for item in data.unordered_array %}
    <div class="cell" onclick="shulteGame(event)">
        <p class="label">{{ item }}</p>
    </div>
    {% endfor %}
    {% for item in data.ordered_array %}
    <div class="hidden-cell">
        <p class="label">{{ item }}</p>
    </div>
    {% endfor %}
</div>
<div class="end-but-container">
    <a class="end-button" href="{% url "exercises:exercise-page" "shulte-table" %}">Завершить</a>
</div>

<script>
    let table = document.getElementById("table");
    let data = document.getElementById("data").dataset;
    let columns = '';
    for (let i = 0; i < parseInt(data.size); i++) {
        columns = columns + '1fr ';
    }
    table.style.gridTemplateColumns = columns;

    if (parseInt(data.size) === 7 || parseInt(data.size) === 9) {
        let labels = document.querySelectorAll(".label");
        labels.forEach(label => {
            label.style.fontSize = "19px";
        });
        let cells = document.querySelectorAll(".cell");
        cells.forEach(cell => {
            cell.style.margin = "7px";
            cell.style.padding = "8px";
        });
        document.getElementById("current-letter").style.margin = "10px auto";
        document.getElementById("table").style.padding = "8px";
    }

    let orderedArray = [];
    document.querySelectorAll(".hidden-cell").forEach(letter => {
        orderedArray.push(letter.firstElementChild.innerHTML);
    });
    let currentLetter = document.getElementById("current-letter");
    currentLetter.innerHTML = orderedArray.pop();

    let isFinalLetter = false;

    function shulteGame(event) {
        clickedLetter = event.target.textContent.trim();
        if (clickedLetter === currentLetter.innerText && orderedArray.length > 0) {
            currentLetter.innerHTML = orderedArray.pop()
        }
        if (orderedArray.length === 0) {
            if (isFinalLetter) {
                currentLetter.innerHTML = "Молодец!";
            } else {
                isFinalLetter = true;
            }
        }
    }

</script>

{% endblock content %}